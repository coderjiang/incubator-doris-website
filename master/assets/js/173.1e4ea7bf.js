(window.webpackJsonp=window.webpackJsonp||[]).push([[173],{624:function(e,t,o){"use strict";o.r(t);var a=o(55),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"faq"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#faq"}},[e._v("#")]),e._v(" FAQ")]),e._v(" "),o("p",[e._v("This document is mainly used to record common problems in the use of Doris. Will be updated from time to time.")]),e._v(" "),o("h3",{attrs:{id:"q1-use-stream-load-to-access-the-public-network-address-of-fe-to-import-data-and-it-is-redirected-to-the-internal-network-ip"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q1-use-stream-load-to-access-the-public-network-address-of-fe-to-import-data-and-it-is-redirected-to-the-internal-network-ip"}},[e._v("#")]),e._v(" Q1. Use Stream Load to access the public network address of FE to import data, and it is redirected to the internal network IP?")]),e._v(" "),o("p",[e._v("When the connection target of stream load is the http port of FE, FE will only randomly select a BE node for http 307 redirect operation, so the user's request is actually sent to a BE designated by FE. The redirect returns the ip of BE, which is the intranet IP. So if you send the request through the public IP of FE, it is very likely that you will not be able to connect because you are redirected to the intranet address.")]),e._v(" "),o("p",[e._v("The usual approach is to ensure that you can access the intranet IP address, or assume a load balance for all BE upper layers, and then directly send the stream load request to the load balancer, and the load balancer transparently transmits the request to the BE node .")]),e._v(" "),o("h3",{attrs:{id:"q2-query-error-failed-to-get-scan-range-no-queryable-replica-found-in-tablet-xxxx"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q2-query-error-failed-to-get-scan-range-no-queryable-replica-found-in-tablet-xxxx"}},[e._v("#")]),e._v(" Q2. Query error: Failed to get scan range, no queryable replica found in tablet: xxxx")]),e._v(" "),o("p",[e._v("This situation is because the corresponding tablet does not find a copy that can be queried, usually because the BE is down, the copy is missing, and so on. You can use the "),o("code",[e._v("show tablet tablet_id")]),e._v(" statement first, and then execute the following "),o("code",[e._v("show proc")]),e._v(" statement to view the copy information corresponding to this tablet, and check whether the copy is complete. At the same time, you can use the "),o("code",[e._v('show proc "/cluster_balance"')]),e._v(" information to query the progress of replica scheduling and repair in the cluster.")]),e._v(" "),o("p",[e._v("For commands related to data copy management, please refer to "),o("RouterLink",{attrs:{to:"/en/administrator-guide/operation/tablet-repair-and-balance.html"}},[e._v("Data Copy Management")]),e._v(".")],1),e._v(" "),o("h3",{attrs:{id:"q3-fe-failed-to-start-fe-log-keeps-scrolling-wait-catalog-to-be-ready-fe-type-unknown"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q3-fe-failed-to-start-fe-log-keeps-scrolling-wait-catalog-to-be-ready-fe-type-unknown"}},[e._v("#")]),e._v(' Q3. FE failed to start, fe.log keeps scrolling "wait catalog to be ready. FE type UNKNOWN"')]),e._v(" "),o("p",[e._v("There are usually two reasons for this problem:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("The local IP obtained when the FE is started this time is inconsistent with the last time, usually because the "),o("code",[e._v("priority_network")]),e._v(" is not set correctly, the wrong IP address is matched when the FE is started. Need to modify "),o("code",[e._v("priority_network")]),e._v(" and restart FE.")])]),e._v(" "),o("li",[o("p",[e._v("Most Follower FE nodes in the cluster are not started. For example, there are 3 Followers and only one is started. At this time, at least one other FE needs to be also activated, and the FE electable group can elect the Master to provide services.")])])]),e._v(" "),o("p",[e._v("If none of the above conditions can be resolved, you can follow the [Metadata Operation and Maintenance Document] (../administrator-guide/operation/metadata-operation.md) in the Doris official website to restore.")]),e._v(" "),o("h3",{attrs:{id:"q4-when-the-be-node-is-offline-through-decommission-why-is-there-always-some-tablet-remaining"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q4-when-the-be-node-is-offline-through-decommission-why-is-there-always-some-tablet-remaining"}},[e._v("#")]),e._v(" Q4. When the BE node is offline through DECOMMISSION, why is there always some tablet remaining?")]),e._v(" "),o("p",[e._v("During the offline process, check the tabletNum of the offline node through show backends, and you will observe that the number of tabletNum is decreasing, indicating that the data fragments are migrating from this node. When the number is reduced to 0, the system will automatically delete this node. But in some cases, tabletNum does not change after it drops to a certain value. This can usually have the following two reasons:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("These tablets belong to the table, partition, or materialized view that has just been deleted. The objects that have just been deleted will remain in the recycle bin. The offline logic will not process these fragments. You can modify the resident time of the object in the recycle bin by modifying the configuration parameter catalog_trash_expire_second of FE. When the object is deleted from the recycle bin, these tablets will be processed.")])]),e._v(" "),o("li",[o("p",[e._v('There is a problem with the migration task of these tablets. At this time, you need to check the error of the specific task through show proc "/cluster_balance".')])])]),e._v(" "),o("p",[e._v('For the above situation, you can first check whether the cluster still has unhealthy shards through show proc "/statistic". If it is 0, you can delete the BE directly through the drop backend statement. Otherwise, you need to check the copy status of unhealthy shards.')]),e._v(" "),o("h3",{attrs:{id:"q5-how-should-priorty-network-be-set"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q5-how-should-priorty-network-be-set"}},[e._v("#")]),e._v(" Q5. How should priorty_network be set?")]),e._v(" "),o("p",[e._v("Priorty_network is a configuration parameter for both FE and BE. This parameter is mainly used to help the system choose the correct network card IP as its own IP. It is recommended to set this parameter explicitly under any circumstances to prevent the problem of incorrect IP selection caused by the addition of a new network card to the subsequent machine.")]),e._v(" "),o("p",[e._v("The value of priorty_network is expressed in CIDR format. It is divided into two parts, the first part is a dotted decimal IP address, and the second part is a prefix length. For example, 10.168.1.0/8 will match all 10.xx.xx.xx IP addresses, and 10.168.1.0/16 will match all 10.168.xx.xx IP addresses.")]),e._v(" "),o("p",[e._v("The reason for using the CIDR format instead of directly specifying a specific IP is to ensure that all nodes can use uniform configuration values. For example, there are two nodes: 10.168.10.1 and 10.168.10.2, then we can use 10.168.10.0/24 as the value of priorty_network.")]),e._v(" "),o("h3",{attrs:{id:"q6-what-are-fe-s-master-follower-and-observer"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q6-what-are-fe-s-master-follower-and-observer"}},[e._v("#")]),e._v(" Q6. What are FE's Master, Follower and Observer?")]),e._v(" "),o("p",[e._v("First of all, make it clear that FE has only two roles: Follower and Observer. The Master is just an FE selected from a group of Follower nodes. Master can be regarded as a special kind of Follower. So when we were asked how many FEs in a cluster and what roles are they, the correct answer should be the number of all FE nodes, the number of Follower roles, and the number of Observer roles.")]),e._v(" "),o("p",[e._v("All FE nodes in the Follower role will form a selectable group, similar to the group concept in the Poxas consensus protocol. A Follower will be elected as the Master in the group. When the Master hangs up, the new Follower will be automatically selected as the Master. Observer will not participate in the election, so Observer will not be called Master.")]),e._v(" "),o("p",[e._v("A metadata log needs to be successfully written in most Follower nodes to be considered successful. For example, if 3 FEs are written, 2 writes are successful. This is why the number of Follower roles needs to be an odd number.")]),e._v(" "),o("p",[e._v("The role of Observer is the same as the meaning of this word. It only acts as an observer to synchronize the metadata logs that have been successfully written, and provides metadata reading services. He will not participate in the logic of majority writing.")]),e._v(" "),o("p",[e._v("Normally, you can deploy 1 Follower + 2 Observer or 3 Follower + N Observer. The former is simple to operate and maintain, and there will be almost no consensus agreement between Followers to cause this complicated error situation (most of Baidu's internal clusters use this method). The latter can ensure the high availability of metadata writing. If it is a high-concurrency query scenario, you can appropriately increase the Observer.")]),e._v(" "),o("h3",{attrs:{id:"q7-tablet-writer-write-failed-tablet-id-27306172-txn-id-28573520-err-235-or-215-or-238"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q7-tablet-writer-write-failed-tablet-id-27306172-txn-id-28573520-err-235-or-215-or-238"}},[e._v("#")]),e._v(" Q7. tablet writer write failed, tablet_id=27306172, txn_id=28573520, err=-235 or -215 or -238")]),e._v(" "),o("p",[e._v("This error usually occurs during data import operations. The error code of the new version is -235, and the error code of the old version may be -215. The meaning of this error is that the data version of the corresponding tablet exceeds the maximum limit (default 500, controlled by the BE parameter "),o("code",[e._v("max_tablet_version_num")]),e._v("), and subsequent writes will be rejected. For example, the error in the question means that the data version of the tablet 27306172 exceeds the limit.")]),e._v(" "),o("p",[e._v("This error is usually because the import frequency is too high, which is greater than the compaction speed of the background data, which causes the version to accumulate and eventually exceeds the limit. At this point, we can first use the show tablet 27306172 statement, and then execute the show proc statement in the result to view the status of each copy of the tablet. The versionCount in the result represents the number of versions. If you find that there are too many versions of a copy, you need to reduce the import frequency or stop importing, and observe whether the number of versions drops. If the version number still does not decrease after the import is stopped, you need to go to the corresponding BE node to check the be.INFO log, search for the tablet id and compaction keywords, and check whether the compaction is running normally. For compaction tuning related, you can refer to the ApacheDoris public account article: Doris Best Practice-Compaction Tuning (3)")]),e._v(" "),o("p",[e._v("The -238 error usually occurs when the amount of imported data in the same batch is too large, which leads to too many Segment files for a certain tablet (the default is 200, which is controlled by the BE parameter "),o("code",[e._v("max_segment_num_per_rowset")]),e._v("). At this time, it is recommended to reduce the amount of data imported in one batch, or to appropriately increase the value of the BE configuration parameter to solve the problem.")]),e._v(" "),o("h3",{attrs:{id:"q8-tablet-110309738-has-few-replicas-1-alive-backends-10003"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q8-tablet-110309738-has-few-replicas-1-alive-backends-10003"}},[e._v("#")]),e._v(" Q8. tablet 110309738 has few replicas: 1, alive backends: [10003]")]),e._v(" "),o("p",[e._v("This error may occur during query or import operation. It usually means that the copy of the tablet is abnormal.")]),e._v(" "),o("p",[e._v("At this point, you can first check whether the BE node is down by using the show backends command, such as the isAlive field is false, or LastStartTime is the most recent time (indicating that it has been restarted recently). If the BE is down, you need to go to the node corresponding to the BE and check the be.out log. If the BE is down due to an exception, usually the exception stack will be printed in be.out to help troubleshoot the problem. If there is no error stack in be.out. You can use the linux command dmesg -T to check whether the process is killed by the system because of OOM.")]),e._v(" "),o("p",[e._v("If no BE node is down, you need to use the show tablet 110309738 statement, and then execute the show proc statement in the result to check the status of each copy of the tablet for further investigation.")]),e._v(" "),o("h3",{attrs:{id:"q9-disk-xxxxx-on-backend-xxx-exceed-limit-usage"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q9-disk-xxxxx-on-backend-xxx-exceed-limit-usage"}},[e._v("#")]),e._v(" Q9. disk xxxxx on backend xxx exceed limit usage")]),e._v(" "),o("p",[e._v("It usually appears in operations such as import and Alter. This error means that the usage of the corresponding disk corresponding to the BE exceeds the threshold (95% by default). At this time, you can use the show backends command first, where MaxDiskUsedPct shows the usage of the disk with the highest usage on the corresponding BE. If If it exceeds 95%, this error will be reported.")]),e._v(" "),o("p",[e._v("At this time, you need to go to the corresponding BE node to check the usage in the data directory. The trash directory and snapshot directory can be manually cleaned up to free up space. If the data directory occupies a lot, you need to consider deleting some data to free up space. For details, please refer to "),o("RouterLink",{attrs:{to:"/en/administrator-guide/operation/disk-capacity.html"}},[e._v("Disk Space Management")]),e._v(".")],1),e._v(" "),o("h3",{attrs:{id:"q10-invalid-cluster-id-xxxx"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q10-invalid-cluster-id-xxxx"}},[e._v("#")]),e._v(" Q10. invalid cluster id: xxxx")]),e._v(" "),o("p",[e._v("This error may appear in the results of the show backends or show frontends commands. It usually appears in the error message column of a certain FE or BE node. The meaning of this error is that after Master FE sends heartbeat information to this node, the node finds that the cluster id carried in the heartbeat information is different from the cluster id stored locally, so it refuses to respond to the heartbeat.")]),e._v(" "),o("p",[e._v("Doris' Master FE node will actively send a heartbeat to each FE or BE node, and will carry a cluster_id in the heartbeat information. The cluster_id is the unique cluster ID generated by the Master FE when a cluster is initialized. When the FE or BE receives the heartbeat information for the first time, it will save the cluster_id locally in the form of a file. The FE file is in the image/ directory of the metadata directory, and BE has a cluster_id file in all data directories. After that, every time a node receives a heartbeat, it will compare the content of the local cluster_id with the content in the heartbeat. If it is inconsistent, it will refuse to respond to the heartbeat.")]),e._v(" "),o("p",[e._v("This mechanism is a node authentication mechanism to prevent receiving wrong heartbeat information from nodes outside the cluster.")]),e._v(" "),o("p",[e._v("If you need to recover from this error. First, confirm whether all nodes are the correct nodes in the cluster. After that, for the FE node, you can try to modify the cluster_id value in the image/VERSION file in the metadata directory and restart the FE. For BE nodes, you can delete cluster_id files in all data directories and restart BE.")]),e._v(" "),o("h3",{attrs:{id:"q11-does-doris-support-modifying-column-names"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q11-does-doris-support-modifying-column-names"}},[e._v("#")]),e._v(" Q11. Does Doris support modifying column names?")]),e._v(" "),o("p",[e._v("Does not support modifying column names.")]),e._v(" "),o("p",[e._v("Doris supports modifying database names, table names, partition names, materialized view (Rollup) names, and column types, comments, default values, and so on. But unfortunately, currently does not support modifying the column name.")]),e._v(" "),o("p",[e._v("For some historical reasons, the column names are currently written directly into the data file. When Doris searches, he also finds the corresponding column by the class name. Therefore, modifying column names is not only a simple metadata modification, but also involves data rewriting, which is a very heavy operation.")]),e._v(" "),o("p",[e._v("We do not rule out the subsequent use of some compatible means to support lightweight column name modification operations.")]),e._v(" "),o("h3",{attrs:{id:"q12-does-the-table-of-the-unique-key-model-support-the-creation-of-materialized-views"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q12-does-the-table-of-the-unique-key-model-support-the-creation-of-materialized-views"}},[e._v("#")]),e._v(" Q12. Does the table of the Unique Key model support the creation of materialized views?")]),e._v(" "),o("p",[e._v("not support.")]),e._v(" "),o("p",[e._v("The table of the Unique Key model is a business-friendly table. Because of its unique function of de-duplication according to the primary key, it can easily synchronize business databases with frequent data changes. Therefore, many users will first consider using the Unique Key model when accessing data to Doris.")]),e._v(" "),o("p",[e._v('Unfortunately, the table of the Unique Key model cannot create a materialized view. The reason is that the nature of the materialized view is to "pre-calculate" the data through pre-calculation, so that the calculated data is directly returned during the query to speed up the query. In the materialized view, the "pre-calculated" data is usually some aggregated indicators, such as summation and count. At this time, if the data changes, such as udpate or delete, because the pre-calculated data has lost the detailed information, it cannot be updated synchronously. For example, a sum of 5 may be 1+4 or 2+3. Because of the loss of detailed information, we cannot distinguish how the sum is calculated, and therefore cannot meet the update requirements.')]),e._v(" "),o("h3",{attrs:{id:"q13-show-backends-frontends-viewed-information-is-incomplete"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q13-show-backends-frontends-viewed-information-is-incomplete"}},[e._v("#")]),e._v(" Q13. show backends/frontends Viewed information is incomplete")]),e._v(" "),o("p",[e._v("After executing certain statements such as "),o("code",[e._v("show backends/frontends")]),e._v(", some columns may be incomplete in the results. For example, the disk capacity information cannot be seen in the show backends results.")]),e._v(" "),o("p",[e._v("This problem usually occurs when there are multiple FEs in the cluster. If users connect to non-Master FE nodes to execute these statements, they will see incomplete information. This is because part of the information only exists in the Master FE node. Such as BE's disk usage information. Therefore, the complete information can be obtained only after the Master FE is directly connected.")]),e._v(" "),o("p",[e._v("Of course, the user can also execute "),o("code",[e._v("set forward_to_master=true;")]),e._v(" before executing these statements. After the session variable is set to true, some information viewing statements executed later will be automatically forwarded to the Master FE to obtain the results. In this way, no matter which FE the user is connected to, the complete result can be obtained.")]),e._v(" "),o("h3",{attrs:{id:"q14-import-data-by-calling-stream-load-through-a-java-program-when-a-batch-of-data-is-large-a-broken-pipe-error-may-be-reported"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q14-import-data-by-calling-stream-load-through-a-java-program-when-a-batch-of-data-is-large-a-broken-pipe-error-may-be-reported"}},[e._v("#")]),e._v(" Q14. Import data by calling stream load through a Java program. When a batch of data is large, a Broken Pipe error may be reported")]),e._v(" "),o("p",[e._v("In addition to Broken Pipe, there may be other strange errors.")]),e._v(" "),o("p",[e._v("This situation usually occurs after opening httpv2. Because httpv2 is an http service implemented using spring boot, and uses tomcat as the default built-in container. But jetty's handling of 307 forwarding seems to have some problems, so the built-in container will be modified to jetty later. In addition, the version of apache http client in the java program needs to use a version later than 4.5.13. In the previous version, there were also some problems with the processing of forwarding.")]),e._v(" "),o("p",[e._v("So this problem can be solved in two ways:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Turn off httpv2")]),e._v(" "),o("p",[e._v("Add enable_http_server_v2=false in fe.conf and restart FE. However, the new UI interface can no longer be used in this way, and some new interfaces based on httpv2 cannot be used later. (Normal import queries are not affected).")])]),e._v(" "),o("li",[o("p",[e._v("Upgrade")]),e._v(" "),o("p",[e._v("You can upgrade to Doris 0.15 and later versions, this problem has been fixed.")])])]),e._v(" "),o("h3",{attrs:{id:"q15-a-new-disk-is-added-to-the-node-why-is-the-data-not-balanced-on-the-new-disk"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q15-a-new-disk-is-added-to-the-node-why-is-the-data-not-balanced-on-the-new-disk"}},[e._v("#")]),e._v(" Q15. A new disk is added to the node. Why is the data not balanced on the new disk?")]),e._v(" "),o("p",[e._v("The current balance strategy of Doris is based on nodes. In other words, the cluster load is judged according to the overall load index of the node (the number of shards and the total disk utilization). And migrate data fragments from high-load nodes to low-load nodes. If each node adds a disk, from the perspective of the node as a whole, the load has not changed, so the balancing logic cannot be triggered.")]),e._v(" "),o("p",[e._v("In addition, Doris currently does not support balanced operations within a single node and between various disks. Therefore, after adding a new disk, the data will not be balanced to the new disk.")]),e._v(" "),o("p",[e._v("However, when data is migrated between nodes, Doris will consider the disk factor. For example, if a slice is migrated from node A to node B, the disk with lower disk space utilization among node B will be selected first.")]),e._v(" "),o("p",[e._v("Here we provide 3 ways to solve this problem:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("Rebuild the new table")]),e._v(" "),o("p",[e._v("Create a new table through the create table like statement, and then use insert into select to synchronize the data from the old table to the new table. Because when a new table is created, the data fragments of the new table will be distributed on the new disk, and the data will also be written to the new disk. This method is suitable for situations where the amount of data is small (within tens of GB).")])]),e._v(" "),o("li",[o("p",[e._v("Through the Decommission command")]),e._v(" "),o("p",[e._v('The decommission command is used to safely decommission a BE node. This command will first migrate the data fragments on the node to other nodes, and then delete the node. As mentioned earlier, when data is migrated, disks with low disk utilization will be given priority, so this method can "force" the data to be migrated to the disks of other nodes. When the data migration is completed, we cancel the decommission operation, so that the data will be rebalanced back to this node. When we perform the above steps for all BE nodes, the data will be evenly distributed on all disks of all nodes.')]),e._v(" "),o("p",[e._v("Note that before executing the decommission command, execute the following command first to avoid the node being deleted after it is offline.")]),e._v(" "),o("p",[o("code",[e._v('admin set frontend config("drop_backend_after_decommission" = "false");')])])]),e._v(" "),o("li",[o("p",[e._v("Manually migrate data using API")]),e._v(" "),o("p",[e._v("Doris provides "),o("RouterLink",{attrs:{to:"/en/administrator-guide/http-actions/tablet-migration-action.html"}},[e._v("HTTP API")]),e._v(", which allows you to manually specify data fragments on one disk to migrate to another disk.")],1)])]),e._v(" "),o("h3",{attrs:{id:"q16-how-to-read-fe-be-log-correctly"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q16-how-to-read-fe-be-log-correctly"}},[e._v("#")]),e._v(" Q16. How to read FE/BE log correctly?")]),e._v(" "),o("p",[e._v("In many cases, we need to troubleshoot problems through logs. Here is an explanation of the format and viewing method of the FE/BE log.")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("FE")]),e._v(" "),o("p",[e._v("FE logs mainly include:")]),e._v(" "),o("ul",[o("li",[e._v("fe.log: main log. Including everything except fe.out.")]),e._v(" "),o("li",[e._v("fe.warn.log: A subset of the main log, which only records WARN and ERROR level logs.")]),e._v(" "),o("li",[e._v("fe.out: Standard/error output log (stdout and stderr).")]),e._v(" "),o("li",[e._v("fe.audit.log: Audit log, which records all SQL requests received by this FE.")])]),e._v(" "),o("p",[e._v("A typical FE log is as follows:")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("2021-09-16 23:13:22,502 INFO (tablet scheduler|43) [BeLoadRebalancer.selectAlternativeTabletsForCluster():85] cluster is balance: default_cluster with medium: HDD. skip\n")])])]),o("ul",[o("li",[o("code",[e._v("2021-09-16 23:13:22,502")]),e._v(": log time.")]),e._v(" "),o("li",[o("code",[e._v("INFO: log level, the default is INFO")]),e._v(".")]),e._v(" "),o("li",[o("code",[e._v("(tablet scheduler|43)")]),e._v(": thread name and thread id. Through the thread id, you can view the thread context information and troubleshoot what happened in this thread.")]),e._v(" "),o("li",[o("code",[e._v("BeLoadRebalancer.selectAlternativeTabletsForCluster():85")]),e._v(": class name, method name and code line number.")]),e._v(" "),o("li",[o("code",[e._v("cluster is balance xxx")]),e._v(": log content.")])]),e._v(" "),o("p",[e._v("Normally, we mainly check the fe.log log. Under special circumstances, some logs may be output to fe.out.")])]),e._v(" "),o("li",[o("p",[e._v("BE")]),e._v(" "),o("p",[e._v("The BE logs mainly include:")]),e._v(" "),o("ul",[o("li",[e._v("be.INFO: Main log. This is actually a soft connection, connected to the latest be.INFO.xxxx.")]),e._v(" "),o("li",[e._v("be.WARNING: A subset of the main log, only logs of WARN and FATAL levels are recorded. This is actually a soft connection, connected to the latest be.WARN.xxxx.")]),e._v(" "),o("li",[e._v("be.out: standard/error output log (stdout and stderr).")])]),e._v(" "),o("p",[e._v("A typical BE log is as follows:")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("I0916 23:21:22.038795 28087 task_worker_pool.cpp:1594] finish report TASK. master host: 10.10.10.10, port: 9222\n")])])]),o("ul",[o("li",[o("code",[e._v("I0916 23:21:22.038795")]),e._v(": Log level and date and time. The capital letter I means INFO, W means WARN, and F means FATAL.")]),e._v(" "),o("li",[o("code",[e._v("28087")]),e._v(": thread id. Through the thread id, you can view the thread context information and troubleshoot what happened in this thread.")]),e._v(" "),o("li",[o("code",[e._v("task_worker_pool.cpp:1594")]),e._v(": code file and line number.")]),e._v(" "),o("li",[o("code",[e._v("finish report TASK xxx")]),e._v(": log content.")])]),e._v(" "),o("p",[e._v("Normally, we mainly check the be.INFO log. Under special circumstances, such as BE downtime, you need to check be.out.")])])]),e._v(" "),o("h3",{attrs:{id:"q17-how-to-troubleshoot-the-cause-of-fe-be-node-down"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q17-how-to-troubleshoot-the-cause-of-fe-be-node-down"}},[e._v("#")]),e._v(" Q17. How to troubleshoot the cause of FE/BE node down?")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("BE")]),e._v(" "),o("p",[e._v("The BE process is a C/C++ process, and the process may hang due to some program bugs (memory out of bounds, illegal address access, etc.) or Out Of Memory (OOM). At this point, we can check the cause of the error through the following steps:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("View be.out")]),e._v(" "),o("p",[e._v("The BE process realizes that when the program exits due to an abnormal condition, it will print the current error stack to be.out (note that it is be.out, not be.INFO or be.WARNING). Through the error stack, you can usually get a rough idea of ​​where the program went wrong.")]),e._v(" "),o("p",[e._v("Note that if an error stack appears in be.out, it is usually due to a program bug, and ordinary users may not be able to solve it by themselves. Welcome to the WeChat group, github discussion or dev mail group for help, and post the corresponding error stack for quick Troubleshoot the problem.")])]),e._v(" "),o("li",[o("p",[e._v("dmesg")]),e._v(" "),o("p",[e._v("If be.out has no stack information, it is likely that OOM was forcibly killed by the system. At this point, you can use the dmesg -T command to view the Linux system log. If a log similar to Memory cgroup out of memory: Kill process 7187 (palo_be) score 1007 or sacrifice child appears at the end, it means that it is caused by OOM.")]),e._v(" "),o("p",[e._v("There may be many reasons for memory problems, such as large queries, imports, compactions, etc. Doris is also constantly optimizing memory usage. Welcome to the WeChat group, github discussion or dev mailing group for help.")])]),e._v(" "),o("li",[o("p",[e._v("Check whether there are logs starting with F in be.INFO.")]),e._v(" "),o("p",[e._v("The log at the beginning of F is the Fatal log. For example, F0916 means the Fatal log on September 16. Fatal logs usually indicate program assertion errors, and assertion errors will directly cause the process to exit (indicating that the program has a bug). Welcome to the WeChat group, github discussion or dev mailing group for help.")])]),e._v(" "),o("li",[o("p",[e._v("Minidump")]),e._v(" "),o("p",[e._v("Mindump is a feature added after Doris 0.15. For details, please refer to "),o("RouterLink",{attrs:{to:"/en/developer-guide/minidump.html"}},[e._v("Document")]),e._v(".")],1)])])]),e._v(" "),o("li",[o("p",[e._v("FE")]),e._v(" "),o("p",[e._v("FE is a java process, and its robustness depends on the C/C++ program. Usually, the cause of FE hanging may be OOM (Out-of-Memory) or metadata writing failure. These errors usually have an error stack in fe.log or fe.out. You need to investigate further based on the error stack information.")])])]),e._v(" "),o("h3",{attrs:{id:"q18-about-the-configuration-of-the-data-directory-ssd-and-hdd"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q18-about-the-configuration-of-the-data-directory-ssd-and-hdd"}},[e._v("#")]),e._v(" Q18. About the configuration of the data directory SSD and HDD.")]),e._v(" "),o("p",[e._v("Doris supports a BE node to configure multiple storage paths. Normally, it is sufficient to configure one storage path for each disk. At the same time, Doris supports storage media attributes of specified paths, such as SSD or HDD. SSD stands for high-speed storage devices, and HDD stands for low-speed storage devices.")]),e._v(" "),o("p",[e._v("By specifying the storage medium properties of the path, we can use Doris's hot and cold data partition storage function to store hot data in the SSD at the partition level, and the cold data will be automatically transferred to the HDD.")]),e._v(" "),o("p",[e._v('It should be noted that Doris does not automatically perceive the actual storage medium type of the disk where the storage path is located. This type needs to be explicitly indicated by the user in the path configuration. For example, the path "/path/to/data1.SSD" means that this path is an SSD storage medium. And "data1.SSD" is the actual directory name. Doris determines the storage medium type based on the ".SSD" suffix behind the directory name, not the actual storage medium type. In other words, the user can specify any path as the SSD storage medium, and Doris only recognizes the directory suffix and will not judge whether the storage medium matches. If you do not write the suffix, the default is HDD.')]),e._v(" "),o("p",[e._v('In other words, ".HDD" and ".SSD" are only used to identify the "relative" "low speed" and "high speed" of the storage directory, not the actual storage medium type. Therefore, if the storage path on the BE node has no difference in media, there is no need to fill in the suffix.')]),e._v(" "),o("h3",{attrs:{id:"q19-lost-connection-to-mysql-server-at-reading-initial-communication-packet-system-error-0"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q19-lost-connection-to-mysql-server-at-reading-initial-communication-packet-system-error-0"}},[e._v("#")]),e._v(" Q19. "),o("code",[e._v("Lost connection to MySQL server at'reading initial communication packet', system error: 0")])]),e._v(" "),o("p",[e._v("If the following problems occur when using the MySQL client to connect to Doris, this is usually caused by the difference between the jdk version used when compiling FE and the jdk version used when running FE.\nNote that when using docker image to compile, the default JDK version is openjdk 11, you can switch to openjdk 8 by command (see the compilation document for details).")]),e._v(" "),o("h3",{attrs:{id:"q20-214-error"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q20-214-error"}},[e._v("#")]),e._v(" Q20. -214 error")]),e._v(" "),o("p",[e._v("When performing operations such as load and query, you may encounter the following errors:")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("failed to initialize storage reader. tablet=63416.1050661139.aa4d304e7a7aff9c-f0fa7579928c85a0, res=-214, backend=192.168.100.10\n")])])]),o("p",[e._v("A -214 error means that the data version of the corresponding tablet is missing. For example, the above error indicates that the data version of the replica of tablet 63416 on the BE of 192.168.100.10 is missing. (There may be other similar error codes, which can be checked and repaired in the following ways).")]),e._v(" "),o("p",[e._v("Normally, if your data has multiple replicas, the system will automatically repair these problematic replicas. You can troubleshoot through the following steps:")]),e._v(" "),o("p",[e._v("First, use the "),o("code",[e._v("show tablet 63416")]),e._v(" statement and execute the "),o("code",[e._v("show proc xxx")]),e._v(" statement in the result to view the status of each replica of the corresponding tablet. Usually we need to care about the data in the "),o("code",[e._v("Version")]),e._v(" column.")]),e._v(" "),o("p",[e._v("Under normal circumstances, the Version of multiple replicas of a tablet should be the same. And it is the same as the VisibleVersion of the corresponding partition.")]),e._v(" "),o("p",[e._v("You can use "),o("code",[e._v("show partitions from tblx")]),e._v(" to view the corresponding partition version (the partition corresponding to the tablet can be obtained in the "),o("code",[e._v("show tablet")]),e._v(" statement.)")]),e._v(" "),o("p",[e._v("At the same time, you can also visit the URL in the CompactionStatus column of the "),o("code",[e._v("show proc")]),e._v(" statement (just open it in the browser) to view more specific version information, to check which version is missing.")]),e._v(" "),o("p",[e._v("If there is no automatic repair for a long time, you need to use the "),o("code",[e._v('show proc "/cluster_balance"')]),e._v(" statement to view the tablet repair and scheduling tasks currently being performed by the system. It may be because there are a large number of tablets waiting to be scheduled, which leads to a long repair time. You can follow the records in "),o("code",[e._v("pending_tablets")]),e._v(" and "),o("code",[e._v("running_tablets")]),e._v(".")]),e._v(" "),o("p",[e._v("Furthermore, you can use the "),o("code",[e._v("admin repair")]),e._v(" statement to specify the priority to repair a table or partition. For details, please refer to "),o("code",[e._v("help admin repair")]),e._v(";")]),e._v(" "),o("p",[e._v("If it still cannot be repaired, then in the case of multiple replicas, we use the "),o("code",[e._v("admin set replica status")]),e._v(" command to force the replica to go offline. For details, please refer to the example of "),o("code",[e._v("help admin set replica status")]),e._v(" to set the status of the replica to bad. (After set to bad, the replica will not be accessed again. And will be automatically repaired later. But before the operation, you should make sure that the other replicas are normal)")]),e._v(" "),o("h3",{attrs:{id:"q21-not-connected-to-192-168-100-1-8060-yet-server-id-384"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q21-not-connected-to-192-168-100-1-8060-yet-server-id-384"}},[e._v("#")]),e._v(" Q21. Not connected to 192.168.100.1:8060 yet, server_id=384")]),e._v(" "),o("p",[e._v("We may encounter this error when loading or querying. If you go to the corresponding BE log to check, you may also find similar errors.")]),e._v(" "),o("p",[e._v("This is an RPC error, and there are usually two possibilities: 1. The corresponding BE node is down. 2. rpc congestion or other errors.")]),e._v(" "),o("p",[e._v("If the BE node is down, you need to check the specific reason for the downtime. Only the problem of rpc congestion is discussed here.")]),e._v(" "),o("p",[e._v("One situation is OVERCROWDED, which means that a large amount of unsent data at the rpc client exceeds the threshold. BE has two parameters related to it:")]),e._v(" "),o("ol",[o("li",[o("code",[e._v("brpc_socket_max_unwritten_bytes")]),e._v(": The default is 1GB. If the unwritten data exceeds this value, an error will be reported. You can modify this value appropriately to avoid OVERCROWDED errors. (But this cures the symptoms rather than the root cause, essentially congestion still occurs).")]),e._v(" "),o("li",[o("code",[e._v("tablet_writer_ignore_eovercrowded")]),e._v(": The default is false. If set to true, Doris will ignore OVERCROWDED errors during the load process. This parameter is mainly used to avoid load failure and improve the stability of load.")])]),e._v(" "),o("p",[e._v("The second is that the packet size of rpc exceeds "),o("code",[e._v("max_body_size")]),e._v(". This problem may occur if the query contains a very large String type or a Bitmap type. It can be circumvented by modifying the following BE parameters:")]),e._v(" "),o("ol",[o("li",[o("code",[e._v("brpc_max_body_size")]),e._v(": The default is 3GB.")])]),e._v(" "),o("h3",{attrs:{id:"q22-the-query-results-of-unique-key-model-are-inconsistent"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q22-the-query-results-of-unique-key-model-are-inconsistent"}},[e._v("#")]),e._v(" Q22.  The query results of unique key model are inconsistent")]),e._v(" "),o("p",[e._v("In some cases, when users use the same SQL to query a table of a unique key model, inconsistent query results may occur. And the query results always change between 2-3 kinds.")]),e._v(" "),o("p",[e._v("This may be because there are data with the same key but different values in the same batch of imported data, which will lead to inconsistent results between different replicas due to uncertain data replace order.")]),e._v(" "),o("p",[e._v("For example, tables are defined as k1 and v1. A batch of imported data is as follows:")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v('1, "abc"\n1, "def"\n')])])]),o("p",[e._v("Then the result of replica 1 may be '1, \"ABC', while the result of replica 2 may be '1,\" def'. This leads to inconsistent query results.")]),e._v(" "),o("p",[e._v("To ensure the unique data order between different replicas, refer to the  "),o("RouterLink",{attrs:{to:"/en/administrator-guide/load-data/sequence-column-manual.html"}},[e._v("Sequence Column")]),e._v(" function.")],1),e._v(" "),o("h3",{attrs:{id:"q23-recoverytracker-should-overlap-or-follow-on-disk-last-vlsn-of-4-422-880-recoveryfirst-4-422-882-unexpected-state-fatal"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#q23-recoverytracker-should-overlap-or-follow-on-disk-last-vlsn-of-4-422-880-recoveryfirst-4-422-882-unexpected-state-fatal"}},[e._v("#")]),e._v(" Q23. "),o("code",[e._v("recoveryTracker should overlap or follow on disk last VLSN of 4,422,880 recoveryFirst= 4,422,882 UNEXPECTED_STATE_FATAL")])]),e._v(" "),o("p",[e._v("Sometimes when restarting the Fe, the above error will occur (usually only in the case of multiple followers), and the difference between the two values in the error is 2. As a result, the Fe startup fails.")]),e._v(" "),o("p",[e._v("This is a bug in bdbje that has not been resolved. In this case, metadata can only be recovered through fault recovery in "),o("RouterLink",{attrs:{to:"/en/administrator-guide/operation/metadata-operation.html"}},[e._v("metadata operation and maintenance manual")]),e._v(".")],1)])}),[],!1,null,null,null);t.default=r.exports}}]);